<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>帳號申請表單</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    label { display: block; margin-top: 12px; }
    input[type="text"], input[type="password"] { width: 300px; padding: 5px; }
    .error { color: red; font-size: 14px; display: none; }
    .school-group { margin-top: 12px; }
    .school-group label { display: block; }
    #total { margin-top: 16px; font-weight: bold; }
    button { margin-top: 20px; padding: 8px 16px; font-size: 16px; }
  </style>
</head>
<body>
  <h2>申請帳號表單</h2>

  <label>真實姓名：<br>
    <input type="text" id="realName">
    <span class="error" id="error-realName">請填寫真實姓名</span>
  </label>

  <label>Facebook姓名與網址（聯絡用，請會匯款完主動私訊粉專）：<br>
    <input type="text" id="fbName">
    <span class="error" id="error-fbName">請填寫 Facebook 姓名與網址</span>
  </label>

  <label>銀行帳號後五碼：<br>
    <input type="text" id="bankLast5">
    <span class="error" id="error-bankLast5">請填寫銀行帳號後五碼</span>
  </label>

  <div class="school-group">
    <strong>欲購買的間數：</strong><br>
    <label><input type="checkbox" class="school" data-name="台大" data-price="600"> 台大（103~114單操輸送/化熱化反/工程數學） - 600元</label>
    <label><input type="checkbox" class="school" data-name="清大" data-price="700"> 清大（103~114單操輸送/化熱化反） - 700元</label>
    <label><input type="checkbox" class="school" data-name="成大" data-price="700"> 成大（103~114單操輸送/化熱/化反） - 700元</label>
    <label><input type="checkbox" class="school" data-name="中央" data-price="550"> 中央（103~114單操輸送/化熱化反） - 550元</label>
    <label><input type="checkbox" class="school" data-name="台科大" data-price="550"> 台科大（103~114單操輸送/化熱化反/工程數學） - 550元</label>
    <label><input type="checkbox" class="school" data-name="中興" data-price="550"> 中興（104~114單操輸送/化熱化反/工程數學） - 550元</label>
    <span class="error" id="error-school">請至少選擇一間學校</span>
  </div>

  <div id="total">總金額：0 元</div>

  <label>申請帳號：<br>
    <input type="text" id="username">
    <span class="error" id="error-username">請填寫帳號</span>
  </label>

  <label>申請密碼：<br>
    <input type="password" id="password">
    <span class="error" id="error-password">請填寫密碼</span>
  </label>

  <button onclick="submitForm()">✅ 送出申請</button>
  <button onclick="resetForm()">🧹 清除重填</button>

  <script>
    const schools = document.querySelectorAll(".school");
    const totalEl = document.getElementById("total");

    schools.forEach(chk => chk.addEventListener("change", updateTotal));

    function updateTotal() {
      let total = 0;
      let count = 0;
      schools.forEach(chk => {
        if (chk.checked) {
          total += Number(chk.dataset.price);
          count++;
        }
      });

      const discount = count === 2 ? 100 : count === 3 ? 200 : count === 4 ? 350 : count === 5 ? 500 : count === 6 ? 800 : 0;
      total -= discount;
      totalEl.textContent = `總金額：${total} 元`;
    }

    function resetForm() {
      document.querySelectorAll("input").forEach(input => {
        if (input.type === "text" || input.type === "password") input.value = "";
        if (input.type === "checkbox") input.checked = false;
      });
      totalEl.textContent = "總金額：0 元";
      document.querySelectorAll(".error").forEach(e => e.style.display = "none");
    }

    function submitForm() {
      const fields = ["realName", "fbName", "bankLast5", "username", "password"];
      let valid = true;
      fields.forEach(id => {
        const el = document.getElementById(id);
        const err = document.getElementById("error-" + id);
        if (!el.value.trim()) {
          err.style.display = "inline";
          valid = false;
        } else {
          err.style.display = "none";
        }
      });

      const checkedSchools = Array.from(schools).filter(s => s.checked);
      const schoolError = document.getElementById("error-school");
      if (checkedSchools.length === 0) {
        schoolError.style.display = "inline";
        valid = false;
      } else {
        schoolError.style.display = "none";
      }

      if (!valid) return alert("❌ 請完整填寫所有欄位");

      const formData = {
        realName: document.getElementById("realName").value.trim(),
        fbName: document.getElementById("fbName").value.trim(),
        bankLast5: document.getElementById("bankLast5").value.trim(),
        username: document.getElementById("username").value.trim(),
        password: document.getElementById("password").value.trim(),
        purchased: {}
      };

      checkedSchools.forEach(s => {
        formData.purchased[s.dataset.name] = true;
      });

      console.log("✅ 將送出的資料：", formData);
      alert("✅ 表單資料已準備好，可進行串接 Firebase（目前僅顯示於 console.log）");
    }
  </script>
</body>
</html>
