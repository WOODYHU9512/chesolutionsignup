<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>åŒ–å·¥è£½é€ æ‰€è¨»å†Šã€ä»˜æ¬¾ç™»è¨˜é é¢</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 30px auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .header img {
      height: 60px;
      border-radius: 8px;
    }
    h2 {
      margin: 0;
    }
    label {
      display: block;
      margin-top: 15px;
    }
    input[type="text"], input[type="password"] {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      box-sizing: border-box;
    }
    .school-option {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
    }
    .school-option label {
      margin: 0;
    }
    button {
      margin-top: 20px;
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
    }
    #result {
      margin-top: 20px;
      font-weight: bold;
      color: green;
      text-align: center;
    }
    footer {
      text-align: center;
      font-size: 12px;
      margin-top: 30px;
      color: #555;
    }
    .note {
      font-size: 14px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="https://raw.githubusercontent.com/WOODYHU9512/cheisgood/main/%E7%9C%9F%E6%AD%A3LOGO.jpeg" alt="logo">
    <h2>åŒ–å·¥è£½é€ æ‰€è¨»å†Šèˆ‡ä»˜è²»ç™»è¨˜ç³»çµ±</h2>
  </div>

  <label>æ‚¨çš„çœŸå¯¦å§“åï¼š<input type="text" id="realName" required></label>
  <label>å€‹äººFacebookç¶²å€(è¯çµ¡ç”¨)ï¼š<input type="text" id="fbName" required></label>

  <label>é¸æ“‡ä»˜æ¬¾æ–¹å¼ï¼š
    <select id="paymentMethod" onchange="showPaymentInput()">
      <option value="">è«‹é¸æ“‡</option>
      <option value="jkopay">è¡—å£æ”¯ä»˜è½‰å¸³</option>
      <option value="ipass">iPass moneyè½‰å¸³</option>
      <option value="bank">éŠ€è¡Œè½‰å¸³</option>
    </select>
  </label>
  <div id="paymentInput"></div>

  <h3>è¦è³¼è²·å“ªå¹¾é–“è€ƒå¤é¡Œ?(è«‹å‹¾é¸)</h3>
  <div id="schools"></div>
  <p><strong>ç¸½é‡‘é¡ï¼š<span id="total">0</span> å…ƒ</strong></p>

  <label>è¨­å®šè§€çœ‹å¸³è™Ÿï¼š<input type="text" id="username" required></label>
  <label>è¨­å®šè§€çœ‹å¯†ç¢¼ï¼š<input type="password" id="password" required></label>

  <button onclick="submitForm()">é€å‡ºç”³è«‹</button>
  <button onclick="clearForm()">æ¸…ç©ºæ‰€æœ‰æ¬„ä½</button>
  <div id="result"></div>

  <footer>
    <p>è‹¥æœ‰æ“ä½œç›¸é—œç–‘å•ï¼Œè«‹è¯çµ¡ <a href="https://www.facebook.com/CHEisverygood/" target="_blank">Facebook ç²‰å°ˆ</a> æˆ–ä¾†ä¿¡ <a href="mailto:cheerfactorysolution@gmail.com">cheerfactorysolution@gmail.com</a></p>
    <p>è‘—ä½œæ¬Šæ‰€æœ‰ï¼Œä¾µå®³å¿…ç©¶ Â© åŒ–å·¥è£½é€ æ‰€</p>
  </footer>

  <script>
    const schoolPrices = {
      "å°å¤§": 600,
      "æ¸…å¤§": 700,
      "æˆå¤§": 700,
      "ä¸­å¤®": 550,
      "å°ç§‘å¤§": 550,
      "ä¸­èˆˆ": 550
    };
    const discount = [0, 0, 100, 200, 350, 500, 800];
    const schoolDiv = document.getElementById("schools");
    const totalDisplay = document.getElementById("total");
    for (const [school, price] of Object.entries(schoolPrices)) {
      const div = document.createElement("div");
      div.className = "school-option";
      div.innerHTML = `<label><input type="checkbox" value="${school}" onchange="updateTotal()"> ${school}ï¼ˆ${price} å…ƒï¼‰</label>`;
      schoolDiv.appendChild(div);
    }

    function updateTotal() {
      const checkboxes = document.querySelectorAll("#schools input[type=checkbox]:checked");
      let sum = 0;
      checkboxes.forEach(cb => sum += schoolPrices[cb.value]);
      const d = discount[checkboxes.length] || 0;
      totalDisplay.innerText = sum - d;
    }

    function clearForm() {
      document.getElementById("realName").value = "";
      document.getElementById("fbName").value = "";
      document.getElementById("username").value = "";
      document.getElementById("password").value = "";
      document.getElementById("paymentInput").innerHTML = "";
      document.getElementById("paymentMethod").value = "";
      document.querySelectorAll("#schools input[type=checkbox]").forEach(cb => cb.checked = false);
      updateTotal();
      document.getElementById("result").innerText = "";
    }

    function showPaymentInput() {
      const method = document.getElementById("paymentMethod").value;
      const container = document.getElementById("paymentInput");
      let html = "";
      if (method === "jkopay") {
        html = `
          <label>æ‚¨çš„è¡—å£å¸³æˆ¶ï¼š<input type="text" id="bankLast5"></label>
          <p class="note"><a href="https://drive.google.com/file/d/1tXpoUGAFQYR0JkMHqPY1Wy7tqOBDUtzZ/view" target="_blank">è¡—å£å¸³æˆ¶è½‰å¸³æ•™å­¸</a></p>
        `;
      } else if (method === "ipass") {
        html = `
          <label>æ‚¨çš„iPass moneyå¸³è™Ÿï¼š<input type="text" id="bankLast5"></label>
          <p class="note"><a href="https://drive.google.com/file/d/1Xea7qybNVBZSaERUWQ5PpWmcyQzQ9p0T/view" target="_blank">iPass moneyè½‰å¸³æ•™å­¸</a></p>
        `;
      } else if (method === "bank") {
        html = `
          <label>æ‚¨çš„éŠ€è¡ŒåŒ¯æ¬¾å¸³è™Ÿå¾Œäº”ç¢¼ï¼š<input type="text" id="bankLast5"></label>
          <p class="note"><a href="https://drive.google.com/file/d/1yZT6J67mfJiE9nIQePPbE59oKcP3zv4g/view" target="_blank">éŠ€è¡Œè½‰å¸³æ•™å­¸</a></p>
        `;
      }
      container.innerHTML = html;
    }

    async function submitForm() {
      const realName = document.getElementById("realName").value.trim();
      const fbName = document.getElementById("fbName").value.trim();
      const bankLast5 = document.getElementById("bankLast5")?.value.trim();
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      const selectedSchools = Array.from(document.querySelectorAll("#schools input[type=checkbox]:checked")).map(cb => cb.value);
      const totalPrice = parseInt(document.getElementById("total").innerText);

      if (!realName || !fbName || !bankLast5 || !username || !password || selectedSchools.length === 0) {
        alert("âŒ è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ä¸¦è‡³å°‘å‹¾é¸ä¸€æ‰€å­¸æ ¡ï¼");
        return;
      }

      const fbUrlPattern = /^https?:\/\/(www\.)?facebook\.com\/[a-zA-Z0-9\.]+$/;
      if (!fbUrlPattern.test(fbName)) {
        alert("âŒ Facebook å€‹äººç¶²å€æ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹ç¢ºèªå¾Œå†é€å‡º");
        return;
      }

      try {
        const checkRes = await fetch("https://us-central1-chesolutionsignup.cloudfunctions.net/checkUsernameExists", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username })
        });
        const checkData = await checkRes.json();
        if (checkData.exists) {
          alert(`âš ï¸ å¸³è™Ÿ ${username} å·²è¢«è¨»å†Šï¼Œè«‹æ”¹ç”¨å…¶ä»–å¸³è™Ÿï¼`);
          return;
        }

        const payload = { realName, fbName, bankLast5, username, password, selectedSchools, totalPrice };
        const res = await fetch("https://us-central1-chesolutionsignup.cloudfunctions.net/submitSignupRequest", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await res.json();
        if (data.success) {
          alert("âœ… é€å‡ºæˆåŠŸï¼Œè«‹è€å¿ƒç­‰å¾…å¯©æ ¸ï¼\nè‹¥æœ‰å•é¡Œè«‹ç§è¨Šæˆ‘å€‘çš„ç²‰å°ˆã€‚");
          clearForm();
        } else {
          document.getElementById("result").innerText = "âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š" + (data.error || "è«‹ç¨å¾Œå†è©¦");
        }
      } catch (err) {
        console.error(err);
        document.getElementById("result").innerText = "ğŸš¨ ç„¡æ³•é€£ç·šï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
      }
    }
  </script>
</body>
</html>
