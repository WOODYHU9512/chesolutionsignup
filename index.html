<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è¨»å†Šé é¢</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 30px auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
    }
    h2 {
      text-align: center;
    }
    label {
      display: block;
      margin-top: 15px;
    }
    input[type="text"], input[type="password"] {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      box-sizing: border-box;
    }
    .school-option {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
    }
    .school-option label {
      margin: 0;
    }
    button {
      margin-top: 20px;
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
    }
    #result {
      margin-top: 20px;
      font-weight: bold;
      color: green;
      text-align: center;
    }
  </style>
</head>
<body>
  <h2>è¨»å†Šç³»çµ±</h2>
  <label>çœŸå¯¦å§“åï¼š<input type="text" id="realName" required></label>
  <label>Facebookå§“åèˆ‡ç¶²å€ï¼š<input type="text" id="fbName" required></label>
  <label>éŠ€è¡Œå¸³è™Ÿå¾Œäº”ç¢¼ï¼š<input type="text" id="bankLast5" required></label>

  <h3>æ¬²è³¼è²·çš„é–“æ•¸ï¼š</h3>
  <div id="schools"></div>

  <p><strong>ç¸½é‡‘é¡ï¼š<span id="total">0</span> å…ƒ</strong></p>

  <label>ç”³è«‹å¸³è™Ÿï¼š<input type="text" id="username" required></label>
  <label>ç”³è«‹å¯†ç¢¼ï¼š<input type="password" id="password" required></label>

  <button onclick="submitForm()">é€å‡ºç”³è«‹</button>
  <button onclick="clearForm()">æ¸…ç©ºæ‰€æœ‰æ¬„ä½</button>
  <div id="result"></div>

  <script>
    const schoolPrices = {
      "å°å¤§": 600,
      "æ¸…å¤§": 700,
      "æˆå¤§": 700,
      "ä¸­å¤®": 550,
      "å°ç§‘å¤§": 550,
      "ä¸­èˆˆ": 550
    };

    const discount = [0, 0, 100, 200, 350, 500, 800];
    const schoolDiv = document.getElementById("schools");
    const totalDisplay = document.getElementById("total");

    for (const [school, price] of Object.entries(schoolPrices)) {
      const div = document.createElement("div");
      div.className = "school-option";
      div.innerHTML = `
        <label><input type="checkbox" value="${school}" onchange="updateTotal()"> ${school}ï¼ˆ${price} å…ƒï¼‰</label>
      `;
      schoolDiv.appendChild(div);
    }

    function updateTotal() {
      const checkboxes = document.querySelectorAll("#schools input[type=checkbox]:checked");
      let sum = 0;
      checkboxes.forEach(cb => {
        sum += schoolPrices[cb.value];
      });
      const d = discount[checkboxes.length] || 0;
      totalDisplay.innerText = sum - d;
    }

    function clearForm() {
      document.getElementById("realName").value = "";
      document.getElementById("fbName").value = "";
      document.getElementById("bankLast5").value = "";
      document.getElementById("username").value = "";
      document.getElementById("password").value = "";
      document.querySelectorAll("#schools input[type=checkbox]").forEach(cb => cb.checked = false);
      updateTotal();
      document.getElementById("result").innerText = "";
    }

    async function submitForm() {
  const realName = document.getElementById("realName").value.trim();
  const fbName = document.getElementById("fbName").value.trim();
  const bankLast5 = document.getElementById("bankLast5").value.trim();
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const selectedSchools = Array.from(document.querySelectorAll("#schools input[type=checkbox]:checked")).map(cb => cb.value);
  const totalPrice = parseInt(document.getElementById("total").innerText);

  if (!realName || !fbName || !bankLast5 || !username || !password || selectedSchools.length === 0) {
    alert("âŒ è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ä¸¦è‡³å°‘å‹¾é¸ä¸€æ‰€å­¸æ ¡ï¼");
    return;
  }

  const payload = {
    realName,
    fbName,
    bankLast5,
    username,
    password,
    selectedSchools,
    totalPrice
  };

  try {
    const res = await fetch("https://us-central1-chesolutionsignup.cloudfunctions.net/submitSignupRequest", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const data = await res.json();
    if (data.success) {
      document.getElementById("result").innerHTML = `
        âœ… é€å‡ºæˆåŠŸï¼Œè«‹è€å¿ƒç­‰å¾…å¯©æ ¸ï¼<br>
        è‹¥æœ‰å•é¡Œè«‹ç§è¨Š <a href="https://www.facebook.com/CHEisverygood" target="_blank">ç²‰å°ˆ</a>ã€‚
      `;
      clearForm();
    } else {
      document.getElementById("result").innerText = "âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š" + (data.error || "è«‹ç¨å¾Œå†è©¦");
    }
  } catch (err) {
    console.error(err);
    document.getElementById("result").innerText = "ğŸš¨ ç„¡æ³•é€£ç·šï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
  }
}

  </script>
</body>
</html>
